Test git rev: ff843132308171db80706b93939807a90c939648
PASS tests/unit/lib/commands/plugins-view.test.js
  ● Console

    console.log
      
      Discovered Claude Code Plugins in /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-view-test-ezNrz7

      at log (../src/lib/commands/plugins-view.js:44:11)

PASS tests/unit/lib/error-handling.test.js
  ● Console

    console.warn
      Malformed JSON in /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-error-A9Is6f/marketplace.json: Expected property name or '}' in JSON at position 1 (line 1 column 2)

      30 |     if (error instanceof SyntaxError) {
      31 |       // eslint-disable-next-line no-console
    > 32 |       console.warn(`Malformed JSON in ${filePath}: ${error.message}`)
         |               ^
      33 |
      34 |       return null
      35 |     }

      at warn (../src/lib/parsers/marketplace-json.js:32:15)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Malformed settings.json, creating backup and using defaults

      60 |     if (error instanceof SyntaxError) {
      61 |       // eslint-disable-next-line no-console
    > 62 |       console.warn('Malformed settings.json, creating backup and using defaults')
         |               ^
      63 |       await createBackup(settingsPath)
      64 |
      65 |       return {

      at warn (../src/lib/storage/claude-settings.js:62:15)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Invalid marketplace.json at /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-error-awlVYD/marketplace.json: missing required fields

      19 |
      20 |     // eslint-disable-next-line no-console
    > 21 |     console.warn(`Invalid marketplace.json at ${filePath}: missing required fields`)
         |             ^
      22 |
      23 |     return null
      24 |   }

      at warn (../src/lib/parsers/marketplace-json.js:21:13)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Invalid skillPath: must be relative and within package

      59 |   if (data.skillPath.includes('..') || path.isAbsolute(data.skillPath)) {
      60 |     // eslint-disable-next-line no-console
    > 61 |     console.warn('Invalid skillPath: must be relative and within package')
         |             ^
      62 |
      63 |     return false
      64 |   }

      at warn (../src/lib/parsers/marketplace-json.js:61:13)
      at validateMarketplaceJson (../src/lib/parsers/marketplace-json.js:16:9)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Invalid marketplace.json at /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-error-xdDC7f/marketplace.json: missing required fields

      19 |
      20 |     // eslint-disable-next-line no-console
    > 21 |     console.warn(`Invalid marketplace.json at ${filePath}: missing required fields`)
         |             ^
      22 |
      23 |     return null
      24 |   }

      at warn (../src/lib/parsers/marketplace-json.js:21:13)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Invalid skillPath: must be relative and within package

      59 |   if (data.skillPath.includes('..') || path.isAbsolute(data.skillPath)) {
      60 |     // eslint-disable-next-line no-console
    > 61 |     console.warn('Invalid skillPath: must be relative and within package')
         |             ^
      62 |
      63 |     return false
      64 |   }

      at warn (../src/lib/parsers/marketplace-json.js:61:13)
      at validateMarketplaceJson (../src/lib/parsers/marketplace-json.js:16:9)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Invalid marketplace.json at /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-error-ApVxAf/marketplace.json: missing required fields

      19 |
      20 |     // eslint-disable-next-line no-console
    > 21 |     console.warn(`Invalid marketplace.json at ${filePath}: missing required fields`)
         |             ^
      22 |
      23 |     return null
      24 |   }

      at warn (../src/lib/parsers/marketplace-json.js:21:13)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Invalid marketplace.json at /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-error-f8dpwt/marketplace.json: missing required fields

      19 |
      20 |     // eslint-disable-next-line no-console
    > 21 |     console.warn(`Invalid marketplace.json at ${filePath}: missing required fields`)
         |             ^
      22 |
      23 |     return null
      24 |   }

      at warn (../src/lib/parsers/marketplace-json.js:21:13)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Invalid marketplace.json at /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-error-lvhuVH/marketplace.json: missing required fields

      19 |
      20 |     // eslint-disable-next-line no-console
    > 21 |     console.warn(`Invalid marketplace.json at ${filePath}: missing required fields`)
         |             ^
      22 |
      23 |     return null
      24 |   }

      at warn (../src/lib/parsers/marketplace-json.js:21:13)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Could not read package.json for /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-error-e1U52U/node_modules/broken-pkg

      86 |   catch {
      87 |     // eslint-disable-next-line no-console
    > 88 |     console.warn(`Could not read package.json for ${packagePath}`)
         |             ^
      89 |   }
      90 |
      91 |   // Resolve symlinks to get canonical path

      at warn (../src/lib/scanner.js:88:13)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.throw (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _throw (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:20:9)

PASS tests/unit/lib/commands/plugins-sync.test.js
PASS tests/unit/lib/storage/claude-settings.test.js
PASS tests/unit/lib/scanner.test.js
  ● Console

    console.warn
      Malformed JSON in /private/var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-scanner-test-ncqJSr/node_modules/bad-plugin/.claude-plugin/marketplace.json: Expected property name or '}' in JSON at position 1 (line 1 column 2)

      30 |     if (error instanceof SyntaxError) {
      31 |       // eslint-disable-next-line no-console
    > 32 |       console.warn(`Malformed JSON in ${filePath}: ${error.message}`)
         |               ^
      33 |
      34 |       return null
      35 |     }

      at warn (../src/lib/parsers/marketplace-json.js:32:15)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Invalid marketplace.json at /private/var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-scanner-test-hmxjb9/node_modules/invalid-plugin/.claude-plugin/marketplace.json: missing required fields

      19 |
      20 |     // eslint-disable-next-line no-console
    > 21 |     console.warn(`Invalid marketplace.json at ${filePath}: missing required fields`)
         |             ^
      22 |
      23 |     return null
      24 |   }

      at warn (../src/lib/parsers/marketplace-json.js:21:13)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

PASS tests/unit/lib/parsers/marketplace-json.test.js
  ● Console

    console.warn
      Invalid skillPath: must be relative and within package

      59 |   if (data.skillPath.includes('..') || path.isAbsolute(data.skillPath)) {
      60 |     // eslint-disable-next-line no-console
    > 61 |     console.warn('Invalid skillPath: must be relative and within package')
         |             ^
      62 |
      63 |     return false
      64 |   }

      at warn (../src/lib/parsers/marketplace-json.js:61:13)
      at Object.<anonymous> (../tests/unit/lib/parsers/marketplace-json.test.js:100:37)

    console.warn
      Invalid skillPath: must be relative and within package

      59 |   if (data.skillPath.includes('..') || path.isAbsolute(data.skillPath)) {
      60 |     // eslint-disable-next-line no-console
    > 61 |     console.warn('Invalid skillPath: must be relative and within package')
         |             ^
      62 |
      63 |     return false
      64 |   }

      at warn (../src/lib/parsers/marketplace-json.js:61:13)
      at Object.<anonymous> (../tests/unit/lib/parsers/marketplace-json.test.js:110:37)

    console.warn
      Malformed JSON in /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-test-LO9yHg/bad.json: Expected property name or '}' in JSON at position 1 (line 1 column 2)

      30 |     if (error instanceof SyntaxError) {
      31 |       // eslint-disable-next-line no-console
    > 32 |       console.warn(`Malformed JSON in ${filePath}: ${error.message}`)
         |               ^
      33 |
      34 |       return null
      35 |     }

      at warn (../src/lib/parsers/marketplace-json.js:32:15)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Invalid marketplace.json at /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-test-zBB7fv/invalid.json: missing required fields

      19 |
      20 |     // eslint-disable-next-line no-console
    > 21 |     console.warn(`Invalid marketplace.json at ${filePath}: missing required fields`)
         |             ^
      22 |
      23 |     return null
      24 |   }

      at warn (../src/lib/parsers/marketplace-json.js:21:13)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Invalid skillPath: must be relative and within package

      59 |   if (data.skillPath.includes('..') || path.isAbsolute(data.skillPath)) {
      60 |     // eslint-disable-next-line no-console
    > 61 |     console.warn('Invalid skillPath: must be relative and within package')
         |             ^
      62 |
      63 |     return false
      64 |   }

      at warn (../src/lib/parsers/marketplace-json.js:61:13)
      at validateMarketplaceJson (../src/lib/parsers/marketplace-json.js:16:9)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Invalid marketplace.json at /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-test-owHEuS/evil.json: missing required fields

      19 |
      20 |     // eslint-disable-next-line no-console
    > 21 |     console.warn(`Invalid marketplace.json at ${filePath}: missing required fields`)
         |             ^
      22 |
      23 |     return null
      24 |   }

      at warn (../src/lib/parsers/marketplace-json.js:21:13)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Invalid skillPath: must be relative and within package

      59 |   if (data.skillPath.includes('..') || path.isAbsolute(data.skillPath)) {
      60 |     // eslint-disable-next-line no-console
    > 61 |     console.warn('Invalid skillPath: must be relative and within package')
         |             ^
      62 |
      63 |     return false
      64 |   }

      at warn (../src/lib/parsers/marketplace-json.js:61:13)
      at validateMarketplaceJson (../src/lib/parsers/marketplace-json.js:16:9)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Invalid marketplace.json at /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-test-3MsaXG/absolute.json: missing required fields

      19 |
      20 |     // eslint-disable-next-line no-console
    > 21 |     console.warn(`Invalid marketplace.json at ${filePath}: missing required fields`)
         |             ^
      22 |
      23 |     return null
      24 |   }

      at warn (../src/lib/parsers/marketplace-json.js:21:13)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Malformed JSON in /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-test-NG7QHX/empty.json: Unexpected end of JSON input

      30 |     if (error instanceof SyntaxError) {
      31 |       // eslint-disable-next-line no-console
    > 32 |       console.warn(`Malformed JSON in ${filePath}: ${error.message}`)
         |               ^
      33 |
      34 |       return null
      35 |     }

      at warn (../src/lib/parsers/marketplace-json.js:32:15)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

    console.warn
      Malformed JSON in /var/folders/b_/cqvmw4wd3p97n3h4qh85kb1c0000gp/T/air-test-IHwGyi/whitespace.json: Unexpected end of JSON input

      30 |     if (error instanceof SyntaxError) {
      31 |       // eslint-disable-next-line no-console
    > 32 |       console.warn(`Malformed JSON in ${filePath}: ${error.message}`)
         |               ^
      33 |
      34 |       return null
      35 |     }

      at warn (../src/lib/parsers/marketplace-json.js:32:15)
      at ../node_modules/@babel/runtime/helpers/regeneratorRuntime.js:52:18
      at Generator.<anonymous> (../node_modules/@babel/runtime/helpers/regenerator.js:52:51)
      at Generator.next (../node_modules/@babel/runtime/helpers/regeneratorDefine.js:11:21)
      at asyncGeneratorStep (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (../node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

PASS tests/unit/lib/types.test.js
PASS tests/unit/lib/utils/parse-library-integration.test.js
-------------------------------|---------|----------|---------|---------|----------------------
File                           | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s    
-------------------------------|---------|----------|---------|---------|----------------------
All files                      |   53.32 |    46.54 |    43.4 |   53.13 |                      
 src/cli                       |       0 |        0 |       0 |       0 |                      
  air.mjs                      |       0 |        0 |       0 |       0 | 1-37                 
 src/lib                       |   97.18 |    85.96 |     100 |   97.56 |                      
  scanner.js                   |   97.01 |    79.48 |     100 |   97.29 | 99                   
  types.js                     |     100 |      100 |     100 |     100 |                      
 src/lib/commands              |   96.05 |    74.45 |     100 |   95.23 |                      
  plugins-sync.js              |   90.19 |    65.62 |     100 |   88.23 | 45,65,70-71          
  plugins-view.js              |      99 |    82.19 |     100 |   98.59 | 149                  
 src/lib/parsers               |   94.87 |    65.78 |     100 |   92.59 |                      
  marketplace-json.js          |   94.87 |    65.78 |     100 |   92.59 | 30,34                
 src/lib/storage               |    91.3 |    74.33 |   91.17 |   89.58 |                      
  claude-config.js             |   76.92 |    66.66 |   57.14 |      75 | 23-31,47             
  claude-settings.js           |    92.8 |    74.76 |     100 |   91.66 | 60,71,90,173,210-213 
 src/lib/utils                 |     100 |      100 |     100 |     100 |                      
  parse-library-integration.js |     100 |      100 |     100 |     100 |                      
 tests/functional              |       0 |        0 |       0 |       0 |                      
  helpers.js                   |       0 |        0 |       0 |       0 | 5-196                
 tests/integration             |       0 |        0 |       0 |       0 |                      
  test-helpers.js              |       0 |        0 |       0 |       0 | 5-479                
 tests/unit/lib                |   93.47 |    57.14 |     100 |   92.59 |                      
  test-lib.js                  |   93.47 |    57.14 |     100 |   92.59 | 16,68                
-------------------------------|---------|----------|---------|---------|----------------------

Test Suites: 8 passed, 8 total
Tests:       113 passed, 113 total
Snapshots:   0 total
Time:        0.438 s, estimated 1 s
Ran all test suites matching test-staging/tests/unit/.
